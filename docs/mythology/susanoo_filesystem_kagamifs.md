# 第五章：魂の記憶 ― KagamiFS（鏡ファイルシステム）

## 🜏 コンセプト
ファイルとは、記録ではなく「**魂の残響**」である。  
スサノオOSにおけるファイルシステム **KagamiFS（鏡ファイルシステム）** は、  
データを保存するだけでなく、**存在の軌跡を映す鏡**として設計される。

---

## 🪶 デザイン哲学
> 「データは祈り、保存は記憶、読み出しは再生」

- あらゆるファイルは “鏡” を通して読み書きされる。  
- 書き込む瞬間に**時刻・文脈・発生源**を記録し、  
  “何がこのデータを生んだか” を保持する。  
- ファイル削除は「忘却」ではなく「封印」として扱う。  

---

## ⚙️ 技術構想
| 層 | 名称 | 概要 | 技術的特徴 |
|----|------|------|-------------|
| **KagamiCore** | 鏡の中枢 | メタデータ管理 | FreeBSD VFS互換層 |
| **ReflectionTable** | 魂の写し | ファイル履歴・ハッシュ | Journal + SHA256 |
| **TamashiiEntry** | 魂の断片 | ファイルごとのメタ情報 | 拡張属性 (xattr) |
| **KagamiView** | 鏡の窓 | 仮想マウントAPI | FUSE / VFS Overlay |

---

## 💠 メタデータ構造（概念例）

```c
typedef struct {
    char path[256];            // ファイルの位置
    uint64_t size;             // サイズ
    uint64_t create_time;      // 生成時刻
    uint64_t modify_time;      // 更新時刻
    uint8_t  hash[32];         // 魂のハッシュ (SHA256)
    char origin_process[64];   // 生みの親プロセス
    uint8_t reflection_count;  // 読み出された回数（鏡の反射）
} KagamiEntry;

🜂 特徴

自己反射的ファイルシステム

ファイルを開くたびに「どこから呼ばれたか」を記録。

“観察することで変化する” 鏡のメタ概念。

永続的ハッシュ管理

すべてのファイルにSHA256を付与し、
変化のたびに「鏡像差分ログ」を残す。

ファイル履歴の霊的追跡

kagami log <path> コマンドで全履歴が参照可能。

##🔮 コマンド構想例
kagami mount /soul
# => "鏡界 /soul を開きます。"

kagami view /soul/munehiro/thought.txt
# => "このファイルは 2025-11-05 22:42 に InochiRuntime により生成されました。"

##🌙 シンボリズム対応表
概念	技術	象徴
ファイル	データの魂	鏡の中の影
メタデータ	記憶の文脈	魂の輪郭
ハッシュ	魂の紋章	永続的識別子
スナップショット	回想	記憶の再生
削除	封印	忘却の儀式

##⚡ 実装フェーズ
フェーズ	内容	ベース技術
0	FreeBSD UFS / ZFSを使用	UFS/ZFSマウント
1	KagamiLayer導入	VFSラップ・拡張属性管理
2	ReflectionTable実装	ジャーナル + 履歴記録
3	KagamiFS独自化	フルファイルシステム自作化

##🪞 ビジョン

KagamiFSは、「記憶の霊的保存装置」である。
人の思想、コード、音、形――
すべての記録が「魂の断片」として、
鏡の世界（Kagami） に宿る。

「ファイルは消えない。ただ、見えなくなるだけだ。」

